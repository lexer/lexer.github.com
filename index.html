<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="initial-scale=1.0, user-scalable=no" />
<meta http-equiv="content-type" content="text/html; charset=UTF-8"/>
<title>Google Maps JavaScript API v3 Example: Map Geolocation</title>
<link href="http://code.google.com/apis/maps/documentation/javascript/examples/default.css" rel="stylesheet" type="text/css" />
<script type="text/javascript" src="http://maps.google.com/maps/api/js?sensor=true"></script>
<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.6.1/jquery.min.js"></script>

</head>
<body>
  <div id="map_canvas"></div>
  <script type="text/javascript">
    $(function(){
      if(navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(function(position) {
          alert(position.coords.accuracy);
          var geocoder = new google.maps.Geocoder();
          var latlng = new google.maps.LatLng(position.coords.latitude, position.coords.longitude);

          geocoder.geocode({'latLng': latlng,'language': 'en'}, function(results, status) {
            if (status == google.maps.GeocoderStatus.OK) {
              var result = results[1];
              if (result) {
                var addressComponents = result.address_components;
                console.log(JSON.stringify(results[1]));
                
                if (addressComponents) {                
                  $.each(addressComponents, function(index, item) {
                    var types = item.types;
                    if (types) {
                      if ($.inArray("locality",types) >= 0 && $.inArray("political",types) >= 0) {
                        alert(item.short_name);
                      }              
                    }
                  });
                }
              }
            } else {
              alert("Geocoder failed due to: " + status);
            }
          });
        });          
      }
    });
  </script>
</body>
</html>

